# 13-01: Unit Testing with Jest ðŸƒ

> *"If you don't test your code, your users will."*

à¸à¸²à¸£à¹€à¸‚à¸µà¸¢à¸™ Test à¸„à¸·à¸­à¸à¸²à¸£à¸¥à¸‡à¸—à¸¸à¸™à¸—à¸µà¹ˆà¸„à¸¸à¹‰à¸¡à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¸‚à¸­à¸‡ Developer ðŸ’°
à¸¡à¸±à¸™à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¹€à¸£à¸²:
1.  **à¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆ**: à¹à¸à¹‰à¹‚à¸„à¹‰à¸”à¹à¸¥à¹‰à¸§à¸‚à¸­à¸‡à¹€à¸à¹ˆà¸²à¹„à¸¡à¹ˆà¸žà¸±à¸‡ (Regression Testing)
2.  **Document**: à¹‚à¸„à¹‰à¸” Test à¸„à¸·à¸­à¹€à¸­à¸à¸ªà¸²à¸£à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸§à¸±à¸™à¸¥à¹‰à¸²à¸ªà¸¡à¸±à¸¢
3.  **Refactor**: à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¹‰à¸”à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸šà¸²à¸¢à¹ƒà¸ˆ

à¸žà¸£à¸°à¹€à¸­à¸à¸‚à¸­à¸‡à¹€à¸£à¸²à¸„à¸·à¸­ **Jest** (Testing Framework à¸ˆà¸²à¸ Facebook) ðŸƒ

> **ðŸ’¡ Analogy (à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸š):**
> à¸à¸²à¸£à¹€à¸‚à¸µà¸¢à¸™ Unit Test à¹€à¸«à¸¡à¸·à¸­à¸™ **"à¸à¸²à¸£à¸Šà¸´à¸¡à¸£à¸ªà¸Šà¸²à¸•à¸´à¸­à¸²à¸«à¸²à¸£à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™"** ðŸ²
> - à¸–à¹‰à¸²à¹€à¸£à¸²à¸£à¸­à¸à¸´à¸™à¸•à¸­à¸™à¹€à¸ªà¸£à¹‡à¸ˆà¸—à¸µà¹€à¸”à¸µà¸¢à¸§ (End-to-End) à¹à¸¥à¹‰à¸§à¹€à¸„à¹‡à¸¡à¹„à¸› à¹€à¸£à¸²à¸­à¸²à¸ˆà¸ˆà¸°à¸•à¹‰à¸­à¸‡à¸—à¸´à¹‰à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¹‰à¸­!
> - à¹à¸•à¹ˆà¸–à¹‰à¸²à¹€à¸£à¸²à¸Šà¸´à¸¡à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ (Unit Test) à¸•à¸­à¸™à¸›à¸£à¸¸à¸‡à¸™à¹‰à¸³à¸‹à¸¸à¸›, à¸•à¸­à¸™à¸—à¸³à¸«à¸¡à¸¹à¸«à¸¡à¸±à¸ à¹€à¸£à¸²à¸ˆà¸°à¸£à¸¹à¹‰à¸—à¸±à¸™à¸—à¸µà¸§à¹ˆà¸²à¸œà¸´à¸”à¸•à¸£à¸‡à¹„à¸«à¸™à¹à¸¥à¸°à¹à¸à¹‰à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢à¸à¸§à¹ˆà¸²à¹€à¸¢à¸­à¸°



## ðŸ› ï¸ Setup Jest

```bash
npm install jest --save-dev
```
*(à¹ƒà¸Šà¹‰ `--save-dev` à¹€à¸žà¸£à¸²à¸°à¹€à¸£à¸²à¹ƒà¸Šà¹‰ Test à¹à¸„à¹ˆà¸•à¸­à¸™ Dev à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸Šà¹‰à¸šà¸™ Production)*

à¹à¸à¹‰ `package.json`:
```json
"scripts": {
  "test": "jest --watchAll"
}
```



## ðŸ§ª First Unit Test

à¸ªà¸¡à¸¡à¸•à¸´à¹€à¸£à¸²à¸¡à¸µà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸šà¸§à¸à¹€à¸¥à¸‚à¹‚à¸‡à¹ˆà¹†:

```javascript
/* sum.js */
function sum(a, b) {
  return a + b;
}
module.exports = sum;
```

à¹€à¸£à¸²à¸ˆà¸°à¹€à¸‚à¸µà¸¢à¸™ Test à¹ƒà¸«à¹‰à¸¡à¸±à¸™ (à¸Šà¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œà¸•à¹‰à¸­à¸‡à¸¥à¸‡à¸—à¹‰à¸²à¸¢à¸”à¹‰à¸§à¸¢ `.test.js` à¸«à¸£à¸·à¸­ `.spec.js`)

```javascript
/* sum.test.js */
const sum = require('./sum');

test('adds 1 + 2 to equal 3', () => {
  // 1. Arrange (à¹€à¸•à¸£à¸µà¸¢à¸¡à¸‚à¸­à¸‡)
  const a = 1;
  const b = 2;

  // 2. Act (à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³)
  const result = sum(a, b);

  // 3. Assert (à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ)
  expect(result).toBe(3);
});
```

à¸£à¸±à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡ `npm test` -> âœ… PASS



## ðŸ” Common Matchers

Jest à¸¡à¸µà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸¢à¸­à¸°à¸¡à¸²à¸:

```javascript
test('Matchers Example', () => {
  // 1. Equal (à¹€à¸—à¹ˆà¸²à¸à¸±à¸™)
  expect(2 + 2).toBe(4);
  expect({ name: 'somchai' }).toEqual({ name: 'somchai' }); // Object à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ toEqual

  // 2. Truthy/Falsy
  expect(null).toBeNull();
  expect('hello').toBeTruthy();
  expect('').toBeFalsy();

  // 3. Number
  expect(10).toBeGreaterThan(5);
  expect(0.1 + 0.2).toBeCloseTo(0.3); // à¸—à¸¨à¸™à¸´à¸¢à¸¡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸•à¸±à¸§à¸™à¸µà¹‰

  // 4. String / Array
  expect('team').not.toMatch(/I/); // à¹„à¸¡à¹ˆà¸¡à¸µà¸•à¸±à¸§ I à¹ƒà¸™ team
  expect(['A', 'B']).toContain('B');
});
```



## ðŸ—ï¸ Structure: Describe & It

à¹€à¸£à¸²à¸™à¸´à¸¢à¸¡à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡ Test à¸”à¹‰à¸§à¸¢ `describe`:

```javascript
describe('Math Operations', () => {
  
  describe('Sum Function', () => {
    test('positive numbers', () => { /* ... */ });
    test('negative numbers', () => { /* ... */ });
  });

  describe('Multiply Function', () => {
    test('multiply by zero', () => { /* ... */ });
  });

});
```



## ðŸ¥Š Challenges

### Level 1: FizzBuzz Test
à¸ˆà¸‡à¹€à¸‚à¸µà¸¢à¸™ Test à¸ªà¸³à¸«à¸£à¸±à¸šà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ FizzBuzz(n):
- à¸–à¹‰à¸²à¸«à¸²à¸£ 3 à¸¥à¸‡à¸•à¸±à¸§ -> "Fizz"
- à¸–à¹‰à¸²à¸«à¸²à¸£ 5 à¸¥à¸‡à¸•à¸±à¸§ -> "Buzz"
- à¸–à¹‰à¸²à¸«à¸²à¸£ 3 à¹à¸¥à¸° 5 à¸¥à¸‡à¸•à¸±à¸§ -> "FizzBuzz"
- à¸™à¸­à¸à¸™à¸±à¹‰à¸™ -> à¸„à¸·à¸™à¸„à¹ˆà¸²à¸•à¸±à¸§à¹€à¸¥à¸‚

::: details âœ¨ à¹€à¸‰à¸¥à¸¢
```javascript
const fizzBuzz = require('./fizzBuzz');

describe('FizzBuzz', () => {
  it('returns Fizz for multiples of 3', () => {
    expect(fizzBuzz(3)).toBe('Fizz');
    expect(fizzBuzz(9)).toBe('Fizz');
  });

  it('returns Buzz for multiples of 5', () => {
    expect(fizzBuzz(5)).toBe('Buzz');
  });

  it('returns FizzBuzz for multiples of 3 and 5', () => {
    expect(fizzBuzz(15)).toBe('FizzBuzz');
  });

  it('returns number for others', () => {
    expect(fizzBuzz(1)).toBe(1);
  });
});
```
:::



## ðŸ“š Glossary

| à¸„à¸³à¸¨à¸±à¸žà¸—à¹Œ | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ |
|:--------|:---------|
| **Unit Test** | à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸«à¸™à¹ˆà¸§à¸¢à¸¢à¹ˆà¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¸‚à¸­à¸‡à¹‚à¸„à¹‰à¸” (Function/Class) à¹à¸¢à¸à¸ˆà¸²à¸à¸ªà¹ˆà¸§à¸™à¸­à¸·à¹ˆà¸™ |
| **Assertion** | à¸à¸²à¸£ "à¸Ÿà¸±à¸™à¸˜à¸‡" à¸§à¹ˆà¸²à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¹à¸šà¸šà¸™à¸µà¹‰ (`expect(...).toBe(...)`) |
| **Mock** | à¸à¸²à¸£à¸ˆà¸³à¸¥à¸­à¸‡à¸‚à¸­à¸‡à¸›à¸¥à¸­à¸¡ (à¹€à¸Šà¹ˆà¸™ Mock Database) à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ Test à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸•à¹ˆà¸­ DB à¸ˆà¸£à¸´à¸‡ |



> ðŸ‘‰ **à¹„à¸›à¸•à¹ˆà¸­: [API Testing with Supertest](/node/13-02-api-testing-supertest)**
