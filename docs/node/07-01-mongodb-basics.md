# Module 7.1: MongoDB Basics üçÉ

> **"Flexible, Scalable, Modern. The database for modern applications."**

‡πÉ‡∏ô‡∏ö‡∏ó‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ö **MongoDB** ‡∏û‡∏£‡∏∞‡πÄ‡∏≠‡∏Å‡∏ù‡∏±‡πà‡∏á **NoSQL** ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡∏¢‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å JavaScript/Node.js ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON-like (BSON) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡πä‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö JavaScript ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡∏î‡πÜ!


## üßê 1. What is NoSQL? (SQL vs NoSQL)

‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡πÅ‡∏ï‡∏∞ MongoDB ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÇ‡∏•‡∏Å‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Table)

| Feature | SQL (Relational) üèõÔ∏è | NoSQL (Non-Relational) üçÉ |
| :--- | :--- | :--- |
| **Structure** | **Table** (‡∏ï‡∏≤‡∏£‡∏≤‡∏á, ‡πÅ‡∏ñ‡∏ß, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå) | **Document** (JSON-like) |
| **Schema** | **Strict** (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î Type ‡πÄ‡∏õ‡πä‡∏∞‡πÜ) | **Flexible** (Schemaless, ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô) |
| **Relations** | **JOIN** (‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á) | **Embedded** (‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô, Join ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏ó‡πà‡∏≤) |
| **Scaling** | **Vertical** (‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏á‡πÜ) | **Horizontal** (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤) |
| **Examples** | MySQL, PostgreSQL | MongoDB, Redis, Cassandra |

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ MongoDB? ‚úÖ
*   ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß (Unstructured Data) ‡πÄ‡∏ä‡πà‡∏ô Log, Sensor Data
*   ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏£‡πá‡∏ß (Rapid Prototyping) ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Database ‡∏ö‡πà‡∏≠‡∏¢
*   ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÉ‡∏ô Object ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Nested Objects)
*   ‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö Scale ‡πÉ‡∏´‡∏ç‡πà‡πÜ (Big Data)


## üê£ Analogy: File Cabinet vs Warehouse

*   **SQL (MySQL)** ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô **"‡∏ï‡∏π‡πâ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏´‡∏•‡πá‡∏Å"** üóÑÔ∏è
    *   ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏•‡∏¥‡πâ‡∏ô‡∏ä‡∏±‡∏Å (Table) ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
    *   ‡πÅ‡∏ü‡πâ‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Row) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
    *   ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏ô‡πâ‡∏ï‡πÅ‡∏õ‡∏∞‡πÄ‡∏≠‡∏≤

*   **NoSQL (MongoDB)** ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô **"‡πÇ‡∏Å‡∏î‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"** üì¶
    *   ‡∏°‡∏µ‡∏Å‡∏•‡πà‡∏≠‡∏á (Collection) ‡∏ß‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô
    *   ‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö (Document) ‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
    *   ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ô‡∏∂‡∏á‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏µ‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡∏≤‡∏ß‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î ‡∏Å‡πá‡∏ß‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
    *   ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÄ‡∏≠‡∏á


## üèóÔ∏è 2. Core Concepts

### 2.1 Hierarchy
1.  **Database**: ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏ç‡πà (‡πÄ‡∏ä‡πà‡∏ô `shop_db`)
2.  **Collection**: ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤ Table) (‡πÄ‡∏ä‡πà‡∏ô `users`, `products`)
3.  **Document**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 1 ‡∏ä‡∏¥‡πâ‡∏ô (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤ Row) (‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON/BSON)

### 2.2 The Document Structure (BSON)
MongoDB ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö **BSON** (Binary JSON) ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô JSON ‡πÅ‡∏ï‡πà‡∏°‡∏µ Type ‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô Date, ObjectId)

```javascript
{
  "_id": ObjectId("65a123..."), // Primary Key (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
  "name": "Somchai",
  "age": 25,
  "isActive": true,
  "skills": ["JavaScript", "MongoDB"], // Array
  "address": {                         // Nested Object
    "city": "Bangkok",
    "zip": "10110"
  },
  "created_at": ISODate("2024-02-15T10:00:00Z")
}
```


## üõ†Ô∏è 3. Setup (MongoDB Atlas)

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏•‡∏á MongoDB ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Å‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£) ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ **MongoDB Atlas** (Cloud Database as a Service) ‡∏ü‡∏£‡∏µ!

### Step-by-Step Guide
1.  ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2.  ‡∏™‡∏£‡πâ‡∏≤‡∏á **Cluster** (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Shared (Free) -> AWS -> Singapore)
3.  **Database Access**: ‡∏™‡∏£‡πâ‡∏≤‡∏á User/Password (‡∏à‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô! ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏°‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
4.  **Network Access**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Allow Access from Anywhere" (`0.0.0.0/0`) (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dev ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
5.  **Get Connection String**:
    *   ‡∏Å‡∏î Connect -> Drivers -> Node.js
    *   Copy URL ‡∏°‡∏≤: `mongodb+srv://<user>:<password>@cluster0.xyz.mongodb.net/`

> **Security Tip**: `mongodb+srv://` ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏•‡∏∏‡∏î‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î!


## üíª 4. Basic CRUD Commands (Mongo Shell)

‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ **MongoDB Compass** (GUI) ‡∏´‡∏£‡∏∑‡∏≠ **Mongo Shell** (CLI) ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

### 4.1 Insert (Create)
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà

```javascript
// ‡πÄ‡∏û‡∏¥‡πà‡∏° 1 ‡∏Ñ‡∏ô
db.users.insertOne({
    name: "John",
    age: 30,
    role: "admin"
})

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô
db.users.insertMany([
    { name: "Jane", age: 25 },
    { name: "Bob", age: 20 }
])
```

### 4.2 Find (Read)
‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏¢‡∏≠‡∏∞)

```javascript
// 1. ‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î (Select All)
db.users.find()

// 2. ‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (WHERE age = 25)
db.users.find({ age: 25 })

// 3. Comparison Operators
db.users.find({ age: { $gt: 20 } })  // Greater Than ($gt) > 20
db.users.find({ age: { $lte: 30 } }) // Less Than or Equal ($lte) <= 30
db.users.find({ age: { $in: [20, 25, 30] } }) // ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ

// 4. Logical Operators
db.users.find({
    $or: [
        { role: "admin" },
        { age: { $lt: 20 } }
    ]
}) // Admin ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 20

// 5. Projection (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏ö‡∏≤‡∏á Field)
// ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà name, ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤ _id
db.users.find({}, { name: 1, _id: 0 })
```

### 4.3 Update
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```javascript
// 1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Update One) - **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ $set**
// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ $set ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà field ‡πÉ‡∏´‡∏°‡πà!
db.users.updateOne(
    { name: "John" },       // Filter (‡πÅ‡∏Å‡πâ‡πÉ‡∏Ñ‡∏£)
    { $set: { age: 31 } }   // Update (‡πÅ‡∏Å‡πâ‡∏≠‡∏∞‡πÑ‡∏£)
)

// 2. ‡πÅ‡∏Å‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Increment)
db.users.updateOne(
    { name: "John" },
    { $inc: { score: 10 } } // ‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 10 (‡∏ñ‡πâ‡∏≤‡∏•‡∏ö‡∏Å‡πá‡πÉ‡∏™‡πà -10)
)

// 3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Array ($push, $pull)
db.users.updateOne(
    { name: "John" },
    { $push: { skills: "React" } } // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Array
)
```

### 4.4 Delete
‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```javascript
// ‡∏•‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
db.users.deleteOne({ name: "Bob" })

// ‡∏•‡∏ö‡πÄ‡∏Å‡∏•‡∏µ‡πâ‡∏¢‡∏á (‡∏£‡∏∞‡∏ß‡∏±‡∏á!)
db.users.deleteMany({})
```


## ‚ö° 5. Advanced: Aggregation Pipeline

‡∏ñ‡πâ‡∏≤ `find()` ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏Å‡πÅ‡∏Å‡∏á, `aggregate()` ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ **"‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£"** üç≥
‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á MongoDB ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô

Concept ‡∏Ñ‡∏∑‡∏≠ **Pipeline**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏´‡∏•‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡πà‡∏≠ ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ

`Data` ‚û°Ô∏è `[$match]` ‚û°Ô∏è `[$group]` ‚û°Ô∏è `[$sort]` ‚û°Ô∏è `Result`

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô**

```javascript
db.users.aggregate([
    // Stage 1: ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà Active
    { $match: { isActive: true } },

    // Stage 2: ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° role ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏≠‡∏≤‡∏¢‡∏∏
    { $group: {
        _id: "$role",
        avgAge: { $avg: "$age" },
        totalPeople: { $sum: 1 }
    }},

    // Stage 3: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏°‡∏≤‡∏Å -> ‡∏ô‡πâ‡∏≠‡∏¢)
    { $sort: { avgAge: -1 } }
])
```


## üîç 6. Indexing (Performance Tuning)

Default ‡πÅ‡∏•‡πâ‡∏ß MongoDB ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Index ‡πÉ‡∏´‡πâ‡πÅ‡∏Ñ‡πà `_id`
‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ `name` ‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡πÅ‡∏ï‡πà‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ Index... MongoDB ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (Collection Scan) -> **‡∏ä‡πâ‡∏≤!** üê¢

### Creating Index
```javascript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á Index ‡∏ó‡∏µ‡πà field "email" (1 = Ascending)
db.users.createIndex({ email: 1 }, { unique: true })
```
*   `unique: true` = ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥ (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Email/Username)

> **Trade-off**: Index ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Read ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà Write ‡∏ä‡πâ‡∏≤‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç)


## üìö 7. Glossary (‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ)

| Term | Definition |
| :--- | :--- |
| **Cluster** | ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á Server MongoDB (‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏°‡∏µ 3 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Replica Set ‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏¢) |
| **Replica Set** | ‡∏Å‡∏≤‡∏£ Copy ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≤‡∏¢ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ |
| **BSON** | Binary JSON - Format ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á Mongo (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Type ‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤ JSON) |
| **ObjectId** | ID ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô (‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Timestamp + Machine ID + Random) |
| **Compass** | ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° GUI ‡∏ü‡∏£‡∏µ‡∏Ç‡∏≠‡∏á MongoDB (‡∏Ñ‡∏ß‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏¥‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ß‡πâ) |


## üèÜ Challenge: Mini Library üìö

‡πÇ‡∏à‡∏ó‡∏¢‡πå: ‡πÉ‡∏ä‡πâ Mongo Shell (‡∏´‡∏£‡∏∑‡∏≠ Compass Shell) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î

1.  ‡∏™‡∏£‡πâ‡∏≤‡∏á Collection `books`
2.  Insert ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ 3 ‡πÄ‡∏•‡πà‡∏° (‡∏°‡∏µ title, author, price, genres array)
3.  Find ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤ **‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 200** ‡πÅ‡∏•‡∏∞‡∏°‡∏µ genre ‡πÄ‡∏õ‡πá‡∏ô **"Fantasy"**
4.  Update ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡πÅ‡∏£‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° genre **"Best Seller"** ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô array
5.  (Optional) Aggregate ‡∏´‡∏≤ **‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°** ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

::: details ‚ú® ‡πÄ‡∏â‡∏•‡∏¢ (‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô)
```javascript
// ‡∏Ç‡πâ‡∏≠ 3
db.books.find({
    price: { $gt: 200 },
    genres: "Fantasy"
})

// ‡∏Ç‡πâ‡∏≠ 4
db.books.updateOne(
    { title: "Harry Potter" },
    { $push: { genres: "Best Seller" } }
)
```
:::


üëâ **[‡πÑ‡∏õ‡∏ï‡πà‡∏≠: Module 7.2 - Mongoose ODM](/node/07-02-mongoose-odm)**
