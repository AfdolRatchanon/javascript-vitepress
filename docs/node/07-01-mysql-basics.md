# 7.1 MySQL & SQL Basics

> *"Data is the new oil."* â€” **Clive Humby**

à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆà¹‚à¸¥à¸à¸‚à¸­à¸‡ **Database** à¸„à¸£à¸±à¸š! ðŸ—„ï¸
à¸–à¹‰à¸²à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸š Application à¹€à¸›à¹‡à¸™à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢, Database à¸à¹‡à¸„à¸·à¸­ "à¸ªà¸¡à¸­à¸‡" à¸—à¸µà¹ˆà¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸ˆà¸”à¸ˆà¸³à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸²à¸§à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™
à¹ƒà¸™ Module à¸™à¸µà¹‰à¹€à¸£à¸²à¸ˆà¸°à¸¡à¸²à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ **Relational Database (SQL)** à¸—à¸µà¹ˆà¸™à¸´à¸¢à¸¡à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹ƒà¸™à¹‚à¸¥à¸à¸•à¸±à¸§à¸«à¸™à¸¶à¹ˆà¸‡ à¸™à¸±à¹ˆà¸™à¸„à¸·à¸­ **MySQL** à¹‚à¸”à¸¢à¹€à¸£à¸²à¸ˆà¸°à¹€à¸‚à¸µà¸¢à¸™ Node.js à¹„à¸›à¸ªà¸±à¹ˆà¸‡à¸‡à¸²à¸™à¸¡à¸±à¸™à¸„à¸£à¸±à¸š

---

## ðŸ£ Analogy: Spreadsheet (Excel)

à¸–à¹‰à¸²à¸„à¸¸à¸“à¹€à¸„à¸¢à¹ƒà¸Šà¹‰ Excel à¸«à¸£à¸·à¸­ Google Sheets à¸„à¸¸à¸“à¸à¹‡à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ Database à¹„à¸›à¸„à¸£à¸¶à¹ˆà¸‡à¸™à¸¶à¸‡à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!

- **Database** = à¹„à¸Ÿà¸¥à¹Œ Excel 1 à¹„à¸Ÿà¸¥à¹Œ (Workbook)
- **Table** = à¹à¸œà¹ˆà¸™à¸‡à¸²à¸™ (Sheet) 1 à¹à¸œà¹ˆà¸™ (à¹€à¸Šà¹ˆà¸™ Sheet "Users", Sheet "Orders")
- **Column** = à¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡ (Field) à¹€à¸Šà¹ˆà¸™ Name, Age, Email (à¸•à¹‰à¸­à¸‡à¸à¸³à¸«à¸™à¸”à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸§à¸‡à¸«à¸™à¹‰à¸²)
- **Row** = à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸•à¹ˆà¸¥à¸°à¸šà¸£à¸£à¸—à¸±à¸” (Record)

à¹à¸•à¹ˆ Database à¸—à¸£à¸‡à¸žà¸¥à¸±à¸‡à¸à¸§à¹ˆà¸²à¸•à¸£à¸‡à¸—à¸µà¹ˆ:
1.  **Scalability**: à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰ **à¸¡à¸«à¸²à¸¨à¸²à¸¥** (à¹€à¸›à¹‡à¸™à¸¥à¹‰à¸²à¸™à¹† à¸šà¸£à¸£à¸—à¸±à¸”à¸à¹‡à¹„à¸«à¸§ à¹ƒà¸™à¸‚à¸“à¸°à¸—à¸µà¹ˆ Excel à¹€à¸£à¸´à¹ˆà¸¡à¸£à¸§à¸™)
2.  **Relations**: **à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¹‚à¸¢à¸‡** à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¹‰à¸²à¸¡à¸•à¸²à¸£à¸²à¸‡à¹„à¸”à¹‰à¹€à¸à¹ˆà¸‡à¸¡à¸²à¸ (à¸ˆà¸¶à¸‡à¹€à¸£à¸µà¸¢à¸à¸§à¹ˆà¸² *Relational* Database)
3.  **Strictness**: **à¹€à¸‚à¹‰à¸¡à¸‡à¸§à¸”** à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (à¸Šà¹ˆà¸­à¸‡à¸™à¸µà¹‰à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™, à¸Šà¹ˆà¸­à¸‡à¸™à¸µà¹‰à¸«à¹‰à¸²à¸¡à¸§à¹ˆà¸²à¸‡) à¸—à¸³à¹ƒà¸«à¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸µà¸„à¸§à¸²à¸¡à¸™à¹ˆà¸²à¹€à¸Šà¸·à¹ˆà¸­à¸–à¸·à¸­

---

## ðŸ†š Comparison: SQL vs NoSQL

à¸à¹ˆà¸­à¸™à¸ˆà¸°à¹„à¸›à¸¥à¸¶à¸à¸‹à¸¶à¹‰à¸‡ à¹€à¸£à¸²à¸¡à¸²à¸”à¸¹à¸„à¸§à¸²à¸¡à¹à¸•à¸à¸•à¹ˆà¸²à¸‡à¸‚à¸­à¸‡ 2 à¸„à¹ˆà¸²à¸¢à¸¢à¸±à¸à¸©à¹Œà¹ƒà¸«à¸à¹ˆà¸à¸±à¸™à¸à¹ˆà¸­à¸™à¸„à¸£à¸±à¸š (à¹ƒà¸™ Module à¸«à¸™à¹‰à¸²à¹€à¸£à¸²à¸ˆà¸°à¹€à¸£à¸µà¸¢à¸™ NoSQL)

| Feature | SQL (MySQL, PostgreSQL) | NoSQL (MongoDB, Firebase) |
|:--------|:------------------------|:--------------------------|
| **Structure** | **Table** (à¸•à¸²à¸£à¸²à¸‡) à¸¡à¸µ Row/Column à¸Šà¸±à¸”à¹€à¸ˆà¸™ | **Document** (JSON) à¸¢à¸·à¸”à¸«à¸¢à¸¸à¹ˆà¸™ |
| **Schema** | **Strict** (à¸•à¹‰à¸­à¸‡à¸à¸³à¸«à¸™à¸”à¸¥à¹ˆà¸§à¸‡à¸«à¸™à¹‰à¸²) | **Dynamic** (à¹ƒà¸ªà¹ˆ field à¸­à¸°à¹„à¸£à¸à¹‡à¹„à¸”à¹‰) |
| **Relations** | **JOIN** (à¸—à¸³à¹„à¸”à¹‰à¸”à¸µà¸¡à¸²à¸) | **Embedded** (à¸—à¸³à¹„à¸”à¹‰à¸¢à¸²à¸à¸à¸§à¹ˆà¸²) |
| **Scalability** | Vertical Scaling (à¹€à¸žà¸´à¹ˆà¸¡ RAM/CPU à¹ƒà¸«à¹‰à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸”à¸µà¸¢à¸§) | Horizontal Scaling (à¹€à¸žà¸´à¹ˆà¸¡à¸ˆà¸³à¸™à¸§à¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡) |
| **Best For** | à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸¡à¸µà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸Šà¸±à¸”à¹€à¸ˆà¸™, à¸à¸²à¸£à¹€à¸‡à¸´à¸™, à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™ | à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸šà¹ˆà¸­à¸¢, Chat log, Analytics, IoT |

> ðŸ’¡ **à¹€à¸¥à¸·à¸­à¸à¹ƒà¸Šà¹‰à¸­à¸°à¹„à¸£à¸”à¸µ?**: à¸–à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸¡à¸µà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹à¸™à¹ˆà¸™à¸­à¸™ (à¹€à¸Šà¹ˆà¸™ à¸šà¸±à¸à¸Šà¸µà¸¥à¸¹à¸à¸„à¹‰à¸², à¸ªà¸•à¹‡à¸­à¸à¸ªà¸´à¸™à¸„à¹‰à¸²) SQL à¸„à¸·à¸­à¸„à¸³à¸•à¸­à¸šà¸—à¸µà¹ˆà¸”à¸µà¸—à¸µà¹ˆà¸ªà¸¸à¸”à¸„à¸£à¸±à¸š

---

## ðŸ“š SQL à¸„à¸·à¸­à¸­à¸°à¹„à¸£?

**SQL (Structured Query Language)** à¸„à¸·à¸­à¸ à¸²à¸©à¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸™à¸—à¸µà¹ˆà¹€à¸£à¸²à¹ƒà¸Šà¹‰ "à¸„à¸¸à¸¢" à¸à¸±à¸š Database à¸„à¸£à¸±à¸š
à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸„à¸¸à¸“à¸ˆà¸°à¹ƒà¸Šà¹‰ MySQL, PostgreSQL, à¸«à¸£à¸·à¸­ SQL Server à¸„à¸¸à¸“à¸à¹‡à¹ƒà¸Šà¹‰ SQL à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™ (à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™à¹à¸„à¹ˆà¸™à¸´à¸”à¸«à¸™à¹ˆà¸­à¸¢à¹ƒà¸™à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¹€à¸‰à¸žà¸²à¸°à¸•à¸±à¸§)

### à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸žà¸·à¹‰à¸™à¸à¸²à¸™ (CRUD)

| Operation | SQL Command | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ |
|:----------|:------------|:---------|
| **C**reate | `INSERT INTO` | à¹€à¸žà¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ |
| **R**ead | `SELECT` | à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸²à¸”à¸¹ |
| **U**pdate | `UPDATE` | à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ |
| **D**elete | `DELETE` | à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ |

---

## ðŸ› ï¸ Setup: à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ MySQL à¸à¸±à¸š Node.js

à¹€à¸£à¸²à¸ˆà¸°à¹ƒà¸Šà¹‰à¹„à¸¥à¸šà¸£à¸²à¸£à¸µà¸Šà¸·à¹ˆà¸­ `mysql2` à¸„à¸£à¸±à¸š (à¹€à¸›à¹‡à¸™à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¸­à¸±à¸›à¹€à¸à¸£à¸”à¸‚à¸­à¸‡ `mysql` à¹€à¸”à¸´à¸¡)
à¹€à¸«à¸•à¸¸à¸œà¸¥à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ `mysql2`:
1.  **Faster**: à¸—à¸³à¸‡à¸²à¸™à¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²
2.  **Promise Support**: à¸£à¸­à¸‡à¸£à¸±à¸š `async/await` à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ wrapper (à¸œà¹ˆà¸²à¸™ `mysql2/promise`)
3.  **Prepared Statements**: à¸¡à¸µà¸£à¸°à¸šà¸šà¸›à¹‰à¸­à¸‡à¸à¸±à¸™ SQL Injection à¸—à¸µà¹ˆà¸”à¸µà¸à¸§à¹ˆà¸²

### 1. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡

```bash
npm install mysql2
```

### 2. à¸ªà¸£à¹‰à¸²à¸‡ Connection Pool (Deep Dive ðŸ—ï¸)

à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡ **Pool**? ðŸ¤”
à¸à¸²à¸£à¹€à¸›à¸´à¸” Connection (`connect()`) à¹„à¸›à¸¢à¸±à¸‡ Database à¹€à¸›à¹‡à¸™à¸à¸£à¸°à¸šà¸§à¸™à¸à¸²à¸£à¸—à¸µà¹ˆ "à¹à¸žà¸‡" à¸„à¸£à¸±à¸š
à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸à¸²à¸£ Handshake, Authenticate, à¹à¸¥à¸°à¸ˆà¸­à¸‡à¸—à¸£à¸±à¸žà¸¢à¸²à¸à¸£à¸à¸±à¹ˆà¸‡ Server à¸–à¹‰à¸²à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¸¡à¸µ Request à¹€à¸‚à¹‰à¸²à¸¡à¸² à¹€à¸£à¸²à¸ªà¸£à¹‰à¸²à¸‡ Connection à¹ƒà¸«à¸¡à¹ˆ -> Query -> à¸›à¸´à¸” Connection... à¹à¸šà¸šà¸™à¸µà¹‰ Server à¸žà¸±à¸‡à¹à¸™à¹ˆà¸™à¸­à¸™!

**Connection Pool** à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸ªà¸¡à¸·à¸­à¸™à¹€à¸£à¸²à¸ˆà¹‰à¸²à¸‡à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¹„à¸§à¹‰ 10 à¸„à¸™ (Connections) à¸™à¸±à¹ˆà¸‡à¸£à¸­à¸£à¸±à¸šà¸ªà¸²à¸¢à¸•à¸¥à¸­à¸”à¹€à¸§à¸¥à¸²
1.  **Request A à¸¡à¸²**: à¸‚à¸­à¸¢à¸·à¸¡à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸„à¸™à¸—à¸µà¹ˆ 1 -> à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ -> à¸„à¸·à¸™à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¹€à¸‚à¹‰à¸² Pool
2.  **Request B à¸¡à¸²**: à¸‚à¸­à¸¢à¸·à¸¡à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸„à¸™à¸—à¸µà¹ˆ 2 -> à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ -> à¸„à¸·à¸™à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¹€à¸‚à¹‰à¸² Pool
3.  **Request à¸¡à¸²à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™ 100 à¸„à¸™**: 10 à¸„à¸™à¹à¸£à¸à¹„à¸”à¹‰à¹ƒà¸Šà¹‰à¸à¹ˆà¸­à¸™, à¸­à¸µà¸ 90 à¸„à¸™à¸•à¹‰à¸­à¸‡ "à¹€à¸‚à¹‰à¸²à¸„à¸´à¸§" à¸£à¸­à¸ˆà¸™à¸à¸§à¹ˆà¸²à¸ˆà¸°à¸¡à¸µà¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸§à¹ˆà¸²à¸‡

```javascript
// db.js
const mysql = require('mysql2/promise'); // à¹ƒà¸Šà¹‰ Promise version

// à¸ªà¸£à¹‰à¸²à¸‡ Pool à¸„à¸£à¸±à¹‰à¸‡à¹€à¸”à¸µà¸¢à¸§ à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸•à¸¥à¸­à¸”à¹„à¸›
const pool = mysql.createPool({
  host: 'localhost',
  user: 'root',
  password: 'password',
  database: 'school_db',
  waitForConnections: true, // à¸–à¹‰à¸² connection à¹€à¸•à¹‡à¸¡ à¹ƒà¸«à¹‰à¸£à¸­à¸„à¸´à¸§ (à¹„à¸¡à¹ˆ error)
  connectionLimit: 10,      // à¸ˆà¸³à¸™à¸§à¸™ Connection à¸ªà¸¹à¸‡à¸ªà¸¸à¸”à¹ƒà¸™ Pool
  queueLimit: 0             // à¸ˆà¸³à¸™à¸§à¸™à¸„à¸´à¸§à¸—à¸µà¹ˆà¸£à¸­à¹„à¸”à¹‰ (0 = à¹„à¸¡à¹ˆà¸ˆà¸³à¸à¸±à¸”)
});

module.exports = pool;
```

---

## ðŸ’» à¸à¸²à¸£à¹€à¸‚à¸µà¸¢à¸™ Query (Async/Await)

à¸¡à¸²à¸¥à¸­à¸‡à¸”à¸¹à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡à¸à¸±à¸™à¸„à¸£à¸±à¸š

### 1. Read (SELECT)

```javascript
const db = require('./db');

async function getUsers() {
  try {
    // query() à¸„à¸·à¸™à¸„à¹ˆà¸² return à¹€à¸›à¹‡à¸™ array: [rows, fields]
    // rows: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹€à¸£à¸²à¸­à¸¢à¸²à¸à¹„à¸”à¹‰ (Array of Objects)
    // fields: à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” column definition (à¸›à¸à¸•à¸´à¹„à¸¡à¹ˆà¸„à¹ˆà¸­à¸¢à¹„à¸”à¹‰à¹ƒà¸Šà¹‰)
    const [rows, fields] = await db.query('SELECT * FROM users');
    
    console.log(rows); 
    // Output: [ { id: 1, name: 'John', age: 25 }, ... ]
    
    return rows;
  } catch (err) {
    console.error("Error fetching users:", err);
  }
}
```

### 2. Create (INSERT)

à¹€à¸§à¸¥à¸²à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ User **à¸«à¹‰à¸²à¸¡** à¹€à¸­à¸² string à¸¡à¸²à¸•à¹ˆà¸­à¸à¸±à¸™à¹€à¸­à¸‡à¹€à¸”à¹‡à¸”à¸‚à¸²à¸”!

```javascript
// âŒ WRONG (Dangerous!)
const sql = `INSERT INTO users (name) VALUES ('${userInput}')`;
```
à¸–à¹‰à¸² `userInput` à¹€à¸›à¹‡à¸™ `somchai'); DROP TABLE users; --` ... à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸¸à¸“à¸«à¸²à¸¢à¹€à¸à¸¥à¸µà¹‰à¸¢à¸‡! ðŸ˜±

```javascript
// âœ… CORRECT (Safe)
async function createUser(name, age) {
  const sql = 'INSERT INTO users (name, age) VALUES (?, ?)';
  
  // db.query(sql, [params]) -> mysql2 à¸ˆà¸°à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ sanitize à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰
  const [result] = await db.query(sql, [name, age]);
  
  console.log(`Created user with ID: ${result.insertId}`);
  return result.insertId;
}
```

> ðŸ›¡ï¸ **Deep Dive: SQL Injection Protection**
> 
> à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸£à¸²à¹ƒà¸Šà¹‰ `?` (Placeholders), `mysql2` à¸ˆà¸°à¸ªà¹ˆà¸‡ Query Structure à¹à¸¥à¸° Data à¹à¸¢à¸à¸à¸±à¸™à¹„à¸›à¹ƒà¸«à¹‰ Database Server à¹€à¸£à¸µà¸¢à¸à¸§à¹ˆà¸² **Prepared Statement**
> Database à¸ˆà¸°à¸¡à¸­à¸‡à¹€à¸«à¹‡à¸™ `userInput` à¹€à¸›à¹‡à¸™à¹à¸„à¹ˆ "à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Text à¸•à¸±à¸§à¸«à¸™à¸¶à¹ˆà¸‡" à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ "à¸„à¸³à¸ªà¸±à¹ˆà¸‡ SQL" à¸ˆà¸¶à¸‡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ 100% à¸„à¸£à¸±à¸š

### 3. Update (UPDATE)

```javascript
async function updateUser(id, newName) {
  const sql = 'UPDATE users SET name = ? WHERE id = ?';
  const [result] = await db.query(sql, [newName, id]);
  
  // result.affectedRows à¸šà¸­à¸à¸ˆà¸³à¸™à¸§à¸™à¹à¸–à¸§à¸—à¸µà¹ˆà¸–à¸¹à¸à¹à¸à¹‰à¹„à¸‚
  if (result.affectedRows === 0) {
    console.log("No user found with that ID");
  } else {
    console.log(`Updated ${result.affectedRows} rows`);
  }
}
```

### 4. Delete (DELETE)

```javascript
async function deleteUser(id) {
  const sql = 'DELETE FROM users WHERE id = ?';
  const [result] = await db.query(sql, [id]);
  
  console.log(`Deleted ${result.affectedRows} rows`);
}
```

---

## ðŸ”„ Transactions (ACID)

à¸™à¸µà¹ˆà¸„à¸·à¸­à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¸‚à¸­à¸‡ SQL Database à¸„à¸£à¸±à¸š!
à¸ªà¸¡à¸¡à¸•à¸´à¸£à¸°à¸šà¸šà¹‚à¸­à¸™à¹€à¸‡à¸´à¸™:
1.  à¸«à¸±à¸à¹€à¸‡à¸´à¸™à¸™à¸²à¸¢ A 100 à¸šà¸²à¸— (`UPDATE`)
2.  (à¹„à¸Ÿà¸”à¸±à¸š / Server Crash / Error) ðŸ’¥
3.  à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸‡à¸´à¸™à¸™à¸²à¸¢ B 100 à¸šà¸²à¸— (`UPDATE`)

à¸–à¹‰à¸²à¹€à¸à¸´à¸” Error à¸•à¸£à¸‡à¸‚à¹‰à¸­ 2... à¹€à¸‡à¸´à¸™à¸™à¸²à¸¢ A à¸«à¸²à¸¢à¹„à¸›à¹à¸¥à¹‰à¸§ à¹à¸•à¹ˆà¹€à¸‡à¸´à¸™à¸™à¸²à¸¢ B à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²! ðŸ’¸
**Transaction** à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¹€à¸£à¸²à¸¡à¸­à¸‡à¸‚à¹‰à¸­ 1, 2, 3 à¹€à¸›à¹‡à¸™ **"à¸à¹‰à¸­à¸™à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™"**:
- à¸–à¹‰à¸²à¸—à¸³à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸«à¸¡à¸” -> **COMMIT** (à¸šà¸±à¸™à¸—à¸¶à¸à¸ˆà¸£à¸´à¸‡)
- à¸–à¹‰à¸²à¸¡à¸µà¸­à¸±à¸™à¹„à¸«à¸™à¸žà¸±à¸‡ -> **ROLLBACK** (à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¹€à¸«à¸¡à¸·à¸­à¸™à¹„à¸¡à¹ˆà¹€à¸„à¸¢à¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™)

```javascript
async function transferMoney(fromId, toId, amount) {
  const connection = await db.getConnection(); // à¸‚à¸­ Connection à¸¡à¸²à¸–à¸·à¸­à¹„à¸§à¹‰à¹€à¸­à¸‡
  
  try {
    await connection.beginTransaction(); // à¹€à¸£à¸´à¹ˆà¸¡ Transaction

    // 1. à¸«à¸±à¸à¹€à¸‡à¸´à¸™ A
    await connection.query('UPDATE accounts SET balance = balance - ? WHERE id = ?', [amount, fromId]);
    
    // 2. à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸‡à¸´à¸™ B
    await connection.query('UPDATE accounts SET balance = balance + ? WHERE id = ?', [amount, toId]);

    await connection.commit(); // âœ… à¸ªà¸³à¹€à¸£à¹‡à¸ˆ: à¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸±à¹‰à¸‡à¸„à¸¹à¹ˆ
    console.log("Transfer successful!");

  } catch (err) {
    await connection.rollback(); // âŒ à¸žà¸±à¸‡: à¸¢à¸à¹€à¸¥à¸´à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¹€à¸‡à¸´à¸™ A à¸à¸¥à¸±à¸šà¸¡à¸²à¹€à¸—à¹ˆà¸²à¹€à¸”à¸´à¸¡)
    console.error("Transfer failed, rolled back:", err);
    throw err;

  } finally {
    connection.release(); // à¸„à¸·à¸™ Connection à¹€à¸‚à¹‰à¸² Pool à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸ˆà¸°à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
  }
}
```

---

## ðŸ” WHERE Clause & Indexing

SQL à¸—à¸£à¸‡à¸žà¸¥à¸±à¸‡à¸•à¸£à¸‡à¸à¸²à¸£à¸à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™:

```sql
-- à¸«à¸²à¸„à¸™à¸—à¸µà¹ˆà¸­à¸²à¸¢à¸¸ 20-30 à¹à¸¥à¸°à¸Šà¸·à¹ˆà¸­à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ A
SELECT * FROM users WHERE age BETWEEN 20 AND 30 AND name LIKE 'A%';

-- à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸š + Pagination
SELECT * FROM users ORDER BY created_at DESC LIMIT 10 OFFSET 0;
```

::: tip ðŸ’¡ Performance Tip: Indexing
à¸–à¹‰à¸²à¹€à¸£à¸²à¸•à¹‰à¸­à¸‡à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ `email` à¸šà¹ˆà¸­à¸¢à¹† (`WHERE email = ?`) à¹€à¸£à¸²à¸„à¸§à¸£à¸ªà¸£à¹‰à¸²à¸‡ **Index** à¹ƒà¸«à¹‰ column email à¸„à¸£à¸±à¸š
Index à¹€à¸«à¸¡à¸·à¸­à¸™ "à¸ªà¸²à¸£à¸šà¸±à¸" à¸—à¹‰à¸²à¸¢à¹€à¸¥à¹ˆà¸¡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­ à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰ Database à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸›à¸´à¸”à¸«à¸²à¸—à¸µà¸¥à¸°à¸«à¸™à¹‰à¸² (Full Table Scan) à¹à¸•à¹ˆà¸à¸£à¸°à¹‚à¸”à¸”à¹„à¸›à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰à¹€à¸¥à¸¢
:::

---

## ðŸŒ Real-World Use Case: Inventory Management

à¹ƒà¸™à¸£à¸°à¸šà¸šà¸„à¸¥à¸±à¸‡à¸ªà¸´à¸™à¸„à¹‰à¸² à¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”
- à¸ªà¸´à¸™à¸„à¹‰à¸²à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸•à¸´à¸”à¸¥à¸š (à¹ƒà¸Šà¹‰ `UNSIGNED INT` à¸«à¸£à¸·à¸­ Check Constraint)
- à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸šà¸´à¸à¸ˆà¹ˆà¸²à¸¢à¸•à¹‰à¸­à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹„à¸”à¹‰
- à¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸•à¹‡à¸­à¸à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ Transaction à¹€à¸žà¸·à¹ˆà¸­à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ Race Condition (à¹à¸¢à¹ˆà¸‡à¸à¸±à¸™à¸•à¸±à¸”à¸ªà¸•à¹‡à¸­à¸à¸ˆà¸™à¸•à¸´à¸”à¸¥à¸š)

à¸™à¸µà¹ˆà¸„à¸·à¸­à¹€à¸«à¸•à¸¸à¸œà¸¥à¸—à¸µà¹ˆà¸£à¸°à¸šà¸š ERP à¸«à¸£à¸·à¸­ Warehouse à¹ƒà¸«à¸à¹ˆà¹† à¸¢à¸±à¸‡à¸„à¸‡à¹€à¸¥à¸·à¸­à¸à¹ƒà¸Šà¹‰ SQL (MySQL/PostgreSQL) à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸à¸„à¸£à¸±à¸š

---

## ðŸ¥Š Challenges

### Level 1: Find by Email (Basic)
à¹€à¸‚à¸µà¸¢à¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ `findUserByEmail(email)` à¸—à¸µà¹ˆà¸£à¸±à¸š email à¹„à¸›à¸„à¹‰à¸™à¸«à¸²à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡ `users`
- à¸–à¹‰à¸²à¹€à¸ˆà¸­ à¹ƒà¸«à¹‰ return object user à¸„à¸™à¸™à¸±à¹‰à¸™
- à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ à¹ƒà¸«à¹‰ return `null`

::: details âœ¨ à¹€à¸‰à¸¥à¸¢
```javascript
async function findUserByEmail(email) {
  const sql = 'SELECT * FROM users WHERE email = ?';
  const [rows] = await db.query(sql, [email]);
  
  // rows à¸„à¸·à¸­ array à¹€à¸ªà¸¡à¸­ à¹à¸¡à¹‰à¸ˆà¸°à¹€à¸ˆà¸­à¸„à¸™à¹€à¸”à¸µà¸¢à¸§
  if (rows.length > 0) {
    return rows[0];
  } else {
    return null;
  }
}
```
:::

### Level 2: Advanced Search (Intermediate)
à¹€à¸‚à¸µà¸¢à¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ `searchProducts(keyword, minPrice)` à¸—à¸µà¹ˆà¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆ:
1.  à¸Šà¸·à¹ˆà¸­ **à¸¡à¸µà¸„à¸³à¸§à¹ˆà¸² keyword à¸œà¸ªà¸¡à¸­à¸¢à¸¹à¹ˆ** (Partial Match)
2.  **à¹à¸¥à¸°** à¸£à¸²à¸„à¸²à¸¡à¸²à¸à¸à¸§à¹ˆà¸² `minPrice`

::: details âœ¨ à¹€à¸‰à¸¥à¸¢
```javascript
async function searchProducts(keyword, minPrice) {
  const searchTerm = `%${keyword}%`;
  
  const sql = 'SELECT * FROM products WHERE name LIKE ? AND price > ?';
  const [rows] = await db.query(sql, [searchTerm, minPrice]);
  
  return rows;
}
```
:::

### Level 3: Soft Delete (Advanced)
à¹ƒà¸™à¸£à¸°à¸šà¸šà¸ˆà¸£à¸´à¸‡ à¹€à¸£à¸²à¸¡à¸±à¸à¹„à¸¡à¹ˆà¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸´à¹‰à¸‡ (`DELETE`) à¹à¸•à¹ˆà¸ˆà¸°à¹à¸„à¹ˆ "à¸‹à¹ˆà¸­à¸™" à¹„à¸§à¹‰ (`UPDATE status = 'deleted'`)
à¸ˆà¸‡à¹€à¸‚à¸µà¸¢à¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ `softDeleteUser(id)` à¸—à¸µà¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ column `is_deleted` à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ `true` à¹à¸—à¸™à¸à¸²à¸£à¸¥à¸šà¸ˆà¸£à¸´à¸‡

::: details âœ¨ à¹€à¸‰à¸¥à¸¢
```javascript
async function softDeleteUser(id) {
  const sql = 'UPDATE users SET is_deleted = 1 WHERE id = ?';
  const [result] = await db.query(sql, [id]);
  console.log(`Soft deleted user ${id}`);
}
```
:::

---

## ðŸ“š Glossary

| à¸„à¸³à¸¨à¸±à¸žà¸—à¹Œ | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ |
|:--------|:---------|
| **RDBMS** | Relational Database Management System (à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸Šà¸´à¸‡à¸ªà¸±à¸¡à¸žà¸±à¸™à¸˜à¹Œ) à¹€à¸Šà¹ˆà¸™ MySQL |
| **Schema** | à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¸­à¸‡ Database (à¸•à¸²à¸£à¸²à¸‡à¸¡à¸µà¸à¸µà¹ˆà¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸›à¸£à¸°à¹€à¸ à¸—à¸­à¸°à¹„à¸£) |
| **Primary Key** | à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸«à¹‰à¸²à¸¡à¸‹à¹‰à¸³ à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸¸à¸•à¸±à¸§à¸•à¸™à¸‚à¸­à¸‡à¹à¸–à¸§à¸™à¸±à¹‰à¸™à¹† (à¸¡à¸±à¸à¸ˆà¸°à¹€à¸›à¹‡à¸™ `id`) |
| **Foreign Key** | à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¹„à¸›à¸¢à¸±à¸‡ Primary Key à¸‚à¸­à¸‡à¸•à¸²à¸£à¸²à¸‡à¸­à¸·à¹ˆà¸™ (à¹€à¸žà¸·à¹ˆà¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¹‚à¸¢à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸žà¸±à¸™à¸˜à¹Œ) |
| **ACID** | à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´ 4 à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¸­à¸‡ Transaction (Atomicity, Consistency, Isolation, Durability) |
| **Transaction** | à¸à¸²à¸£à¸¡à¸±à¸”à¸£à¸§à¸¡à¸Šà¸¸à¸”à¸„à¸³à¸ªà¸±à¹ˆà¸‡ SQL à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸à¹‰à¸­à¸™à¹€à¸”à¸µà¸¢à¸§ (à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸•à¹‰à¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸«à¸¡à¸” à¸žà¸±à¸‡à¸•à¹‰à¸­à¸‡à¸¢à¸à¹€à¸¥à¸´à¸à¸«à¸¡à¸”) |
| **SQL Injection** | à¹€à¸—à¸„à¸™à¸´à¸„à¸à¸²à¸£à¹‚à¸ˆà¸¡à¸•à¸µà¹€à¸§à¹‡à¸šà¹‚à¸”à¸¢à¸à¸²à¸£à¹à¸—à¸£à¸à¸„à¸³à¸ªà¸±à¹ˆà¸‡ SQL à¸£à¹‰à¸²à¸¢à¸¥à¸‡à¹„à¸›à¹ƒà¸™ input |
| **Connection Pool** | à¹€à¸—à¸„à¸™à¸´à¸„à¸à¸²à¸£à¹€à¸›à¸´à¸” Connection à¸„à¹‰à¸²à¸‡à¹„à¸§à¹‰à¸«à¸¥à¸²à¸¢à¹† à¹€à¸ªà¹‰à¸™ à¹€à¸žà¸·à¹ˆà¸­à¸™à¸³à¸à¸¥à¸±à¸šà¸¡à¸²à¹ƒà¸Šà¹‰à¹ƒà¸«à¸¡à¹ˆ |
| **Prepared Statement** | à¸à¸²à¸£à¹€à¸‚à¸µà¸¢à¸™ SQL à¹à¸šà¸šà¹à¸¢à¸à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (à¹ƒà¸Šà¹‰ `?`) à¹€à¸žà¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ |
| **Normalization** | à¸à¸£à¸°à¸šà¸§à¸™à¸à¸²à¸£à¸­à¸­à¸à¹à¸šà¸š Database à¹€à¸žà¸·à¹ˆà¸­à¸¥à¸”à¸„à¸§à¸²à¸¡à¸‹à¹‰à¸³à¸‹à¹‰à¸­à¸™à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ |

---

> ðŸ‘‰ **à¹„à¸›à¸•à¹ˆà¸­: [Project: Student Management DB](/node/07-project-student-db)**
